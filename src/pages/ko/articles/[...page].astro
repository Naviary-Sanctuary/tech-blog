---
import type { GetStaticPaths, InferGetStaticPropsType } from "astro";
import BaseLayout from "../../../layouts/BaseLayout.astro";
import Title from "../../../components/Title.astro";
import { getCollection } from "astro:content";
import Link from "../../../components/Link.astro";
import Divider from "../../../components/Divider.astro";
import Pagination from "../../../components/Pagination.astro";

type Props = InferGetStaticPropsType<typeof getStaticPaths>;

export const getStaticPaths = (async ({ paginate }) => {
  const posts = (await getCollection("koBlog", ({ data }) => !data.draft)).sort(
    (a, b) => new Date(b.data.date).valueOf() - new Date(a.data.date).valueOf(),
  );

  return paginate(posts, { pageSize: 5 });
}) satisfies GetStaticPaths;

const { page } = Astro.props;
---

<BaseLayout
  title="Articles"
  description="나비어리의 기술은 기록에서 시작됩니다."
>
  <!-- Articles Section -->
  <section
    class="max-w-4xl mx-auto py-12 md:py-20 px-4 sm:px-6 min-h-[80dvh] flex flex-col"
  >
    <!-- Article header -->
    <div class="mb-3 flex items-end justify-between">
      <Title>Articles</Title>
    </div>
    <Divider />
    <!-- Articles -->
    <div class="flex flex-col gap-8 mt-10">
      {
        page.data.map((post) => {
          return (
            <Link
              href={`/articles/post/${post.id}`}
              class="group block rounded-xl -mx-3 px-3 py-4 transition-all duration-200 hover:bg-tertiary/2 hover:shadow-[0_1px_0_rgba(0,0,0,0.04)] focus-visible:outline focus-visible:outline-offset-2 focus-visible:outline-primary/60 active:scale-[0.998]"
              aria-label={`${post.data.title} 글 읽기`}
            >
              <article class="flex flex-col gap-3 sm:flex-row sm:gap-10">
                <time
                  datetime={post.data.date}
                  class="shrink-0 pt-1 w-fit whitespace-nowrap text-xs sm:text-sm tracking-wide text-zinc-400"
                >
                  {post.data.date}
                </time>

                <div class="flex flex-col gap-3">
                  <div class="inline-flex w-fit items-center rounded-[4px] border border-zinc-300/70 px-2 py-0.5 text-[11px] font-medium tracking-wide text-secondary">
                    {post.data.category}
                  </div>
                  <h3 class="text-xl font-bold leading-snug text-zinc-900">
                    {post.data.title}
                  </h3>
                  <p class="text-sm sm:text-[15px] leading-7 text-zinc-600">
                    {post.data.description}
                  </p>
                </div>
              </article>
            </Link>
          );
        })
      }
    </div>
    <div class="mt-auto pt-12">
      <Pagination currentPage={page.currentPage} totalPage={page.lastPage} />
    </div>
  </section>
</BaseLayout>
